---
title: "What makes you Happy?"
author: "Yang Yang (yy2819)"
output:
  html_document:
    df_print: paged
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```
*Reminder: some codes are hidden from the html report.  
To see the full code, please see the "FinalReport.Rmd".  
If you wanna run whole code, turn all chunks' eval option into TRUE*

![](../figs/emotion.png)

This project aims to analysis what makes people happy, from the data collected in [HappyDB](https://rit-public.github.io/HappyDB/)  
HappyDB is a corpus of 100,000 crowd-sourced happy moments via Amazon's Mechanical Turk.
The survey question is:
```
What made you happy today?  Reflect on the past {24 hours|3 months}, and recall three actual events that happened to you that made you happy.  Write down your happy moment in a complete sentence.
Write three such moments.
Examples of happy moments we are NOT looking for (e.g events in distant past, partial sentence):
    - The day I married my spouse
    - My Dog
```
You can read more about it on https://arxiv.org/abs/1801.07746


```{r load libraries, warning=FALSE, message=FALSE, echo=FALSE, cache=TRUE}
packages.used=c("tm", "tidytext", "tidyverse", 
                "DT", "mallet", "syuzhet",
                "scales","wordcloud2","gridExtra",
                "ngram","plotly")

# check packages that need to be installed.
packages.needed=setdiff(packages.used, 
                        intersect(installed.packages()[,1], 
                                  packages.used))
# install additional packages
if(length(packages.needed)>0){
  install.packages(packages.needed, dependencies = TRUE)
}

library(tm)
library(tidytext)
library(tidyverse)
library(DT)
library(mallet)
library(syuzhet)

library(scales)
library(wordcloud2)
library(gridExtra)
library(ngram)

library(plotly)
```

### Step 0 - Load the data and pre-process them

The *text_processing.Rmd*(provided by ) clean the text by converting all the letters to the lower case, and removing punctuation, numbers, empty words, extra white space, and stemming words, removing stop words, and choosing the words with highest frequency for each moments.  

*However, the original text_processing.Rmd* has some weakness, which didn't transform different verb tense to its simple tense very well.
```{r read data, warning=FALSE, message=FALSE, cache=TRUE}
# Load Data (Download if not exists)
if(!file.exists("../data/cleaned_hm.csv")){
  urlfile<-'https://raw.githubusercontent.com/rit-public/HappyDB/master/happydb/data/cleaned_hm.csv'
  hm_data <- read_csv(urlfile)
}
# Process data if the processed_moments not exists
if(!file.exists("../output/processed_moments.csv")){
  hm_data = read_csv("../data/cleaned_hm.csv")
  source(purl("../lib/Text_Processing.Rmd",output=tempfile()))
}
if(!file.exists("../data/demographic.csv")){
  urlfile<-'https://raw.githubusercontent.com/rit-public/HappyDB/master/happydb/data/demographic.csv'
  demo_data <- read_csv(urlfile)
}
demo_data=read_csv("../data/demographic.csv")
hm_data=read_csv("../output/processed_moments.csv")
```

We also combine the happy moments data with the worker's demographic data.  
To make our research more specific, we filter out some special data like other gender, NA gender.   
[Code hided]
```{r combining data, warning=FALSE, message=FALSE,echo=FALSE, cache=TRUE}
# Combine both the data sets and keep the required columns for analysis
# We select a subset of the data that satisfies specific row conditions.
hm_data <- hm_data %>%
  inner_join(demo_data, by = "wid") %>%
  select(wid,
         original_hm,
         gender, 
         marital, 
         parenthood,
         reflection_period,
         age, 
         country, 
         ground_truth_category, 
         text) %>%
  mutate(count = sapply(hm_data$text, wordcount)) %>%
  mutate(originalcount = sapply(hm_data$original_hm, wordcount)) %>%
  filter(gender %in% c("m", "f")) %>%
  filter(marital %in% c("single", "married")) %>%
  filter(parenthood %in% c("n", "y")) %>%
  filter(reflection_period %in% c("24h", "3m")) %>%
  mutate(reflection_period = fct_recode(reflection_period, 
                                        months_3 = "3m", hours_24 = "24h"))

```

# Basic Exploration of Data

## Description
First, let's have a quick look at several data examples:
```{r example data, warning=FALSE, message=FALSE,echo=FALSE, cache=TRUE}
head(hm_data)
```
We can see, that demographic data include their gender, marital, parentihood, age, country, etc. And the original happy moments data consists of 1 sentence in each moment.  
For detail Description, see [HappyDB](https://rit-public.github.io/HappyDB/)  

## Word Count
We can perform a statistical analysis based on the number of words. 
```{r wordcount, cache=TRUE}
summary(hm_data$originalcount)
```
So strange, how can the moments sentence be so long as 1155? Let's see those long sentence with length > 1000
```{r, warning=FALSE, message=FALSE,echo=FALSE, cache=TRUE}
substr(hm_data$original_hm[hm_data$originalcount>1000],0,200)
```
Oh, I see, these people just ignore the requirement of the tasks! **They wrote essays about their happy moments!!**
OK, just exclude them from the data. 
No way to let them increase their weight by 100 times huh.
```{r, cache=TRUE}
hm_data=hm_data[hm_data$originalcount<500,]
summary(hm_data$originalcount)
hist(hm_data$originalcount[hm_data$originalcount<100],main="Happy Moments' Sentence Length",xlab = "Length")
```

Most of the happy moments are short sentences, as expected!  
Some happy moments even have only two words.

## Happiness Doesn't Depend on Demographic Difference
We tried to find out whether **Demographic Difference** influence Happiness. 




```{r sentiment, cache=TRUE}

sentiment.values.v <- get_sentiment(hm_data$text[hm_data$gender=='m'], method="syuzhet")
summary(sentiment.values.v)
boxplot(sentiment.values.v, ylim=c(-5, 20), main="Male", ylab="Sentiment of Experiences")
```
```{r, cache=TRUE}
p <- plot_ly(type = 'box') %>%
    add_boxplot(y = sentiment.values.v, boxpoints = 'outliers',
              marker = list(color = 'rgb(7,40,89)'),
              line = list(color = 'rgb(7,40,89)'),
              name = "All Points")
```
